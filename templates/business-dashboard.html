<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dashboard - Swift Serve</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/swift.css">
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 120px auto;
            padding: 0 20px;
        }
        .welcome-header {
            background: var(--bg-color-1);
            box-shadow: var(--box-shadow);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .welcome-header h1 {
            color: var(--text-color-1);
            font-size: 2.5rem;
        }
        .welcome-text span {
            color: var(--orange);
            font-weight: bold;
        }
        .header-buttons {
            display: flex;
            gap: 15px;
        }
        .student-verify-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.6rem;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .student-verify-btn i {
            margin-right: 8px;
            font-size: 1.8rem;
        }
        .logout-btn {
            background: var(--orange);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.6rem;
            cursor: pointer;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: var(--bg-color-1);
            box-shadow: var(--box-shadow);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
        }
        .stat-card h3 {
            color: var(--text-color-1);
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .stat-card .count {
            color: var(--orange);
            font-size: 3rem;
            font-weight: bold;
        }
        .dashboard-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: var(--bg-color-1);
            box-shadow: var(--box-shadow);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .panel h2 {
            color: var(--text-color-1);
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ddd;
        }
        .menu-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .menu-item:last-child {
            border-bottom: none;
        }
        .menu-item-info h4 {
            color: var(--text-color-1);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        .menu-item-info p {
            color: var(--text-color-2);
            font-size: 1.4rem;
        }
        .menu-item-price {
            color: var(--orange);
            font-size: 1.8rem;
            font-weight: bold;
        }
        .add-item-btn {
            background: var(--orange);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.6rem;
            cursor: pointer;
            margin-top: 1rem;
            display: block;
            width: 100%;
        }
        .order {
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f5f5f5;
            border-radius: 0.5rem;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .order-id {
            font-weight: bold;
        }
        .order-status {
            padding: 0.3rem 0.8rem;
            border-radius: 2rem;
            font-size: 1.4rem;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        .status-in-progress {
            background: #cce5ff;
            color: #004085;
        }
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        .order-details {
            margin-top: 0.5rem;
            font-size: 1.4rem;
        }
        .action-btns {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }
        .action-btns button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 0.3rem;
            cursor: pointer;
        }
        .accept-btn {
            background: #28a745;
            color: white;
        }
        .reject-btn {
            background: #dc3545;
            color: white;
        }
        .update-btn {
            background: #007bff;
            color: white;
        }
        .status-select {
            flex: 2;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 0.3rem;
            font-size: 1.4rem;
        }
        
        @media (max-width: 768px) {
            .dashboard-panels {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="main">
        <div class="page">
            <header class="header">
                <a href="/index.html" class="logo"><i class="ri-restaurant-2-fill"></i> SWIFT SERVE</a>
                <nav class="navbar">
                    <a href="/explorecode.html">Explore</a>
                    <a href="#" class="active">Dashboard</a>
                    <a href="/api/logout">Logout</a>
                </nav>
            </header>
            
            <div class="dashboard-container">
                <div class="welcome-header">
                    <div class="welcome-text">
                        <h1>Welcome, <span id="business-name">Business</span></h1>
                        <p>Manage your food business here</p>
                    </div>
                    <div class="header-buttons">
                        <a href="/student-verification.html" class="student-verify-btn" id="student-verify-btn" style="display: none;">
                            <i class="ri-user-follow-line"></i>
                            Student Verification
                        </a>
                        <a href="/api/logout" class="logout-btn">Logout</a>
                    </div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Today's Orders</h3>
                        <div class="count">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="count">â‚¹0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Menu Items</h3>
                        <div class="count">0</div>
                    </div>
                </div>
                
                <div class="dashboard-panels">
                    <div class="panel">
                        <h2>Your Menu</h2>
                        <div class="menu-list" id="menu-items-container">
                            <!-- Menu items will be loaded here -->
                        </div>
                        <button class="add-item-btn" id="add-item-btn">Add New Item</button>
                    </div>
                    
                    <div class="panel">
                        <h2>Recent Orders</h2>
                        <div class="orders-list" id="orders-container">
                            <p>Loading orders...</p>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Business Information</h2>
                    <div id="business-info">
                        <p><strong>Business Name:</strong> <span id="info-business-name">Your Restaurant</span></p>
                        <p><strong>Owner:</strong> <span id="info-owner-name">Owner Name</span></p>
                        <p><strong>Email:</strong> <span id="info-email">business@example.com</span></p>
                        <p><strong>Phone:</strong> <span id="info-phone">+91 1234567890</span></p>
                        <p><strong>Address:</strong> <span id="info-address">123 Business Street, Mumbai</span></p>
                        <p><strong>Business Type:</strong> <span id="info-business-type">Restaurant</span></p>
                    </div>
                </div>

                <!-- Admin Menu Section - Only visible for main admin (business_id = 1) -->
                <div id="admin-section" class="dashboard-section" style="display: none;">
                    <h2 class="section-title">Admin Tools</h2>
                    <div class="menu-item-grid admin-grid">
                        <div class="admin-card">
                            <i class="ri-user-follow-line"></i>
                            <h3>Student Verification</h3>
                            <p>Verify student ID cards for discount eligibility</p>
                            <a href="/admin-students.html" class="btn">Manage</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <section class="footer">
                <div class="box-container">
                    <div class="box">
                        <h3>Quick Links</h3>
                        <a href="/index.html"><i class="ri-home-5-fill"></i> Home</a>
                        <a href="/explorecode.html"><i class="ri-search-line"></i> Explore</a>
                        <a href="#"><i class="ri-dashboard-fill"></i> Dashboard</a>
                    </div>
    
                    <div class="box">
                        <h3>Contact Info</h3>
                        <a href="tel:+919356360179"><i class="ri-contacts-fill"></i> +91-9356360179</a>
                        <a href="mailto:swiftserver999@gmail.com"><i class="ri-mail-unread-fill"></i> swiftserver999@gmail.com</a>
                        <a href="#"><i class="ri-map-pin-2-fill"></i> Mumbai, Raigad-410203</a>
                    </div>
    
                    <div class="box">
                        <h3>Follow Us</h3>
                        <a href="#"><i class="ri-facebook-circle-fill"></i> Facebook</a>
                        <a href="#"><i class="ri-twitter-fill"></i> Twitter</a>
                        <a href="#"><i class="ri-instagram-fill"></i> Instagram</a>
                        <a href="#"><i class="ri-whatsapp-fill"></i> Whatsapp</a>
                    </div>
                </div>
                
                <div class="credit">
                    <p>&copy; 2025 Swift Serve. All rights reserved.</p>
                </div>
            </section>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch business data from the server
            fetch('/api/business-data')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Not logged in or server error');
                    }
                    return response.json();
                })
                .then(data => {
                    // Update business information
                    document.getElementById('business-name').textContent = data.business_name;
                    document.getElementById('info-business-name').textContent = data.business_name;
                    document.getElementById('info-owner-name').textContent = data.owner_name;
                    document.getElementById('info-email').textContent = data.email;
                    document.getElementById('info-phone').textContent = data.phone || 'Not provided';
                    document.getElementById('info-address').textContent = data.address;
                    document.getElementById('info-business-type').textContent = data.business_type;
                    
                    // Store the business data for later use
                    window.businessData = data;
                    
                    // After loading business data, fetch menu items
                    fetchMenuItems();
                    
                    // After loading business data, fetch orders
                    fetchOrders();
                    
                    // Check if admin and show admin section
                    checkAdminStatus();
                })
                .catch(error => {
                    console.error('Error fetching business data:', error);
                    // Redirect to login if not logged in
                    if (error.message === 'Not logged in or server error') {
                        window.location.href = '/login.html?error=not_logged_in&type=business';
                    }
                });
            
            // Fetch business orders from the server
            function fetchOrders() {
                const ordersContainer = document.getElementById('orders-container');
                ordersContainer.innerHTML = '<p>Loading orders...</p>';
                
                fetch('/api/business/orders')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch orders');
                        }
                        return response.json();
                    })
                    .then(orders => {
                        // Clear loading message
                        ordersContainer.innerHTML = '';
                        
                        // Check if there are any orders
                        if (orders.length === 0) {
                            ordersContainer.innerHTML = '<p>No orders received yet.</p>';
                            return;
                        }
                        
                        // Create and append order elements
                        orders.forEach(order => {
                            const orderElement = createOrderElement(order);
                            ordersContainer.appendChild(orderElement);
                        });
                        
                        // Add order count to stats
                        updateOrderCount(orders.length);
                        
                        // Calculate total revenue
                        updateTotalRevenue(orders);
                    })
                    .catch(error => {
                        console.error('Error fetching orders:', error);
                        ordersContainer.innerHTML = '<p>Failed to load orders. Please try again later.</p>';
                    });
            }
            
            // Create an order element
            function createOrderElement(order) {
                const orderElement = document.createElement('div');
                orderElement.className = 'order';
                orderElement.setAttribute('data-id', order.id);
                
                // Format date
                const orderDate = new Date(order.order_date);
                const formattedDate = orderDate.toLocaleString();
                
                // Format status for display
                const statusDisplay = formatStatusDisplay(order.status);
                const statusClass = getStatusClass(order.status);
                
                // Create order items string
                let itemsText = '';
                if (order.items && order.items.length > 0) {
                    itemsText = order.items.map(item => `${item.quantity}x ${item.item_name}`).join(', ');
                } else {
                    itemsText = 'No items found';
                }
                
                // Format price with discount info if applicable
                let priceDisplay = `â‚¹${parseFloat(order.total_amount).toFixed(2)}`;
                if (order.discount_applied) {
                    const originalPrice = order.original_amount || (parseFloat(order.total_amount) * 2);
                    priceDisplay = `
                        <span style="text-decoration: line-through; color: #999; margin-right: 5px;">â‚¹${originalPrice.toFixed(2)}</span>
                        <span style="color: #28a745; font-weight: bold;">â‚¹${parseFloat(order.total_amount).toFixed(2)}</span>
                        <span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 10px; font-size: 12px;">STUDENT -${order.discount_percentage}%</span>
                    `;
                }
                
                // Create the order HTML
                orderElement.innerHTML = `
                    <div class="order-header">
                        <span class="order-id">Order #${order.id}</span>
                        <span class="order-status ${statusClass}">${statusDisplay}</span>
                    </div>
                    <div class="order-details">
                        <p><strong>Customer:</strong> ${order.customer_name}</p>
                        <p><strong>Contact:</strong> ${order.customer_phone} | ${order.customer_email}</p>
                        <p><strong>Address:</strong> ${order.delivery_address}</p>
                        <p><strong>Items:</strong> ${itemsText}</p>
                        <p><strong>Total:</strong> ${priceDisplay}</p>
                        <p><strong>Payment:</strong> ${order.payment_method}</p>
                        <p><strong>Date:</strong> ${formattedDate}</p>
                        ${order.special_instructions ? `<p><strong>Instructions:</strong> ${order.special_instructions}</p>` : ''}
                    </div>
                `;
                
                // Add action buttons for pending orders
                if (order.status === 'pending') {
                    const actionBtns = document.createElement('div');
                    actionBtns.className = 'action-btns';
                    
                    // Accept button
                    const acceptBtn = document.createElement('button');
                    acceptBtn.className = 'accept-btn';
                    acceptBtn.textContent = 'Accept';
                    acceptBtn.addEventListener('click', () => updateOrderStatus(order.id, 'accepted'));
                    
                    // Reject button
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className = 'reject-btn';
                    rejectBtn.textContent = 'Reject';
                    rejectBtn.addEventListener('click', () => updateOrderStatus(order.id, 'cancelled'));
                    
                    actionBtns.appendChild(acceptBtn);
                    actionBtns.appendChild(rejectBtn);
                    orderElement.appendChild(actionBtns);
                } 
                // Add status update buttons for non-completed orders
                else if (order.status !== 'delivered' && order.status !== 'cancelled') {
                    const actionBtns = document.createElement('div');
                    actionBtns.className = 'action-btns';
                    
                    // Create a dropdown for status updates
                    const statusSelect = document.createElement('select');
                    statusSelect.className = 'status-select';
                    
                    // Add options based on current status
                    const nextStatuses = getNextStatuses(order.status);
                    nextStatuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status.value;
                        option.textContent = status.label;
                        statusSelect.appendChild(option);
                    });
                    
                    // Update button
                    const updateBtn = document.createElement('button');
                    updateBtn.className = 'update-btn';
                    updateBtn.textContent = 'Update Status';
                    updateBtn.addEventListener('click', () => {
                        const selectedStatus = statusSelect.value;
                        if (selectedStatus) {
                            updateOrderStatus(order.id, selectedStatus);
                        }
                    });
                    
                    actionBtns.appendChild(statusSelect);
                    actionBtns.appendChild(updateBtn);
                    orderElement.appendChild(actionBtns);
                }
                
                return orderElement;
            }
            
            // Format status for display
            function formatStatusDisplay(status) {
                switch (status) {
                    case 'pending': return 'Pending';
                    case 'accepted': return 'Accepted';
                    case 'preparing': return 'Preparing';
                    case 'out_for_delivery': return 'Out for Delivery';
                    case 'on_the_way': return 'On the Way';
                    case 'delivered': return 'Delivered';
                    case 'cancelled': return 'Cancelled';
                    default: return status.charAt(0).toUpperCase() + status.slice(1);
                }
            }
            
            // Get CSS class based on order status
            function getStatusClass(status) {
                switch (status) {
                    case 'pending': return 'status-pending';
                    case 'accepted': 
                    case 'preparing': 
                    case 'on_the_way':
                    case 'out_for_delivery': return 'status-in-progress';
                    case 'delivered': return 'status-completed';
                    case 'cancelled': return 'status-cancelled';
                    default: return 'status-pending';
                }
            }
            
            // Get next possible statuses based on current status
            function getNextStatuses(currentStatus) {
                switch (currentStatus) {
                    case 'accepted':
                        return [
                            { value: 'preparing', label: 'Preparing' },
                            { value: 'cancelled', label: 'Cancel Order' }
                        ];
                    case 'preparing':
                        return [
                            { value: 'out_for_delivery', label: 'Out for Delivery' },
                            { value: 'on_the_way', label: 'On the Way' },
                            { value: 'cancelled', label: 'Cancel Order' }
                        ];
                    case 'out_for_delivery':
                        return [
                            { value: 'on_the_way', label: 'On the Way' },
                            { value: 'delivered', label: 'Delivered' },
                            { value: 'cancelled', label: 'Cancel Order' }
                        ];
                    case 'on_the_way':
                        return [
                            { value: 'delivered', label: 'Delivered' },
                            { value: 'cancelled', label: 'Cancel Order' }
                        ];
                    default:
                        return [];
                }
            }
            
            // Update order status
            function updateOrderStatus(orderId, newStatus) {
                // Confirm before cancelling
                if (newStatus === 'cancelled' && !confirm('Are you sure you want to cancel this order?')) {
                    return;
                }
                
                // Create form data
                const formData = new FormData();
                formData.append('order_id', orderId);
                formData.append('status', newStatus);
                
                // Send status update request
                fetch('/api/order/update-status', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Refresh orders list
                        fetchOrders();
                    } else {
                        alert('Error updating order status: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error updating order status:', error);
                    alert('Error updating order status. Please try again later.');
                });
            }
            
            // Update order count in stats
            function updateOrderCount(count) {
                // Count only today's orders
                const today = new Date().toDateString();
                const todayOrders = document.querySelectorAll('.order').length;
                
                const orderCountElement = document.querySelector('.stat-card:nth-child(1) .count');
                if (orderCountElement) {
                    orderCountElement.textContent = todayOrders || 0;
                }
            }
            
            // Update total revenue in stats
            function updateTotalRevenue(orders) {
                let totalRevenue = 0;
                
                // Calculate total from all orders
                orders.forEach(order => {
                    if (order.status !== 'cancelled') {
                        totalRevenue += parseFloat(order.total_amount || 0);
                    }
                });
                
                const revenueElement = document.querySelector('.stat-card:nth-child(2) .count');
                if (revenueElement) {
                    revenueElement.textContent = 'â‚¹' + totalRevenue.toFixed(2);
                }
            }
            
            // Fetch menu items function
            function fetchMenuItems() {
                fetch('/api/menu-items')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch menu items');
                        }
                        return response.json();
                    })
                    .then(items => {
                        displayMenuItems(items);
                        updateMenuItemCount(items.length);
                    })
                    .catch(error => {
                        console.error('Error fetching menu items:', error);
                    });
            }
            
            // Display menu items in the container
            function displayMenuItems(items) {
                const container = document.getElementById('menu-items-container');
                container.innerHTML = ''; // Clear existing items
                
                if (items.length === 0) {
                    container.innerHTML = '<p style="text-align: center; padding: 20px;">No menu items yet. Add your first item!</p>';
                    return;
                }
                
                // Group items by category
                const itemsByCategory = {};
                items.forEach(item => {
                    const category = item.category || 'Uncategorized';
                    if (!itemsByCategory[category]) {
                        itemsByCategory[category] = [];
                    }
                    itemsByCategory[category].push(item);
                });
                
                // Create elements for each category and its items
                for (const category in itemsByCategory) {
                    // Add category header
                    const categoryHeader = document.createElement('h3');
                    categoryHeader.textContent = category;
                    categoryHeader.style.marginTop = '15px';
                    categoryHeader.style.marginBottom = '10px';
                    categoryHeader.style.paddingBottom = '5px';
                    categoryHeader.style.borderBottom = '1px solid #eee';
                    container.appendChild(categoryHeader);
                    
                    // Add items in this category
                    itemsByCategory[category].forEach(item => {
                        const itemElement = createMenuItemElement(item);
                        container.appendChild(itemElement);
                    });
                }
            }
            
            // Create a menu item element
            function createMenuItemElement(item) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'menu-item';
                itemDiv.setAttribute('data-id', item.id);
                
                // Apply a style if item is not available
                if (item.is_available === 0) {
                    itemDiv.style.opacity = '0.6';
                }
                
                // Item info (name and description)
                const infoDiv = document.createElement('div');
                infoDiv.className = 'menu-item-info';
                
                const nameH4 = document.createElement('h4');
                nameH4.textContent = item.item_name;
                
                const descP = document.createElement('p');
                descP.textContent = item.description || 'No description';
                
                infoDiv.appendChild(nameH4);
                infoDiv.appendChild(descP);
                
                // Item price
                const priceDiv = document.createElement('div');
                priceDiv.className = 'menu-item-price';
                priceDiv.textContent = `â‚¹${parseFloat(item.price).toFixed(2)}`;
                
                // Action buttons (edit/delete)
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'menu-item-actions';
                actionsDiv.style.display = 'flex';
                actionsDiv.style.flexDirection = 'column';
                actionsDiv.style.gap = '5px';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.style.padding = '3px 8px';
                editBtn.style.background = '#f0ad4e';
                editBtn.style.color = 'white';
                editBtn.style.border = 'none';
                editBtn.style.borderRadius = '3px';
                editBtn.style.cursor = 'pointer';
                editBtn.onclick = () => editMenuItem(item);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.style.padding = '3px 8px';
                deleteBtn.style.background = '#d9534f';
                deleteBtn.style.color = 'white';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '3px';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.onclick = () => deleteMenuItem(item.id);
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                
                // Assemble the item element
                itemDiv.appendChild(infoDiv);
                itemDiv.appendChild(priceDiv);
                itemDiv.appendChild(actionsDiv);
                
                return itemDiv;
            }
            
            // Update the menu item count in the stats card
            function updateMenuItemCount(count) {
                const countElement = document.querySelector('.stat-card:nth-child(3) .count');
                if (countElement) {
                    countElement.textContent = count;
                }
            }
            
            // Handler for Add New Item button
            document.getElementById('add-item-btn').addEventListener('click', function() {
                // Create simple modal for adding an item
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.left = '0';
                modal.style.top = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
                modal.style.display = 'flex';
                modal.style.justifyContent = 'center';
                modal.style.alignItems = 'center';
                modal.style.zIndex = '1000';
                
                const modalContent = document.createElement('div');
                modalContent.style.backgroundColor = 'white';
                modalContent.style.padding = '20px';
                modalContent.style.borderRadius = '10px';
                modalContent.style.maxWidth = '500px';
                modalContent.style.width = '90%';
                
                modalContent.innerHTML = `
                    <h2 style="margin-top: 0;">Add New Menu Item</h2>
                    <form id="add-item-form">
                        <div style="margin-bottom: 15px;">
                            <label for="item_name" style="display: block; margin-bottom: 5px;">Item Name *</label>
                            <input type="text" id="item_name" name="item_name" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="description" style="display: block; margin-bottom: 5px;">Description</label>
                            <textarea id="description" name="description" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 80px;"></textarea>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="price" style="display: block; margin-bottom: 5px;">Price (â‚¹) *</label>
                            <input type="number" id="price" name="price" step="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="category" style="display: block; margin-bottom: 5px;">Category</label>
                            <input type="text" id="category" name="category" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="image_url" style="display: block; margin-bottom: 5px;">Image URL</label>
                            <input type="text" id="image_url" name="image_url" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                            <button type="button" id="cancel-btn" style="padding: 10px 15px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 10px 15px; background: var(--orange); color: white; border: none; border-radius: 4px; cursor: pointer;">Add Item</button>
                        </div>
                    </form>
                `;
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Cancel button closes the modal
                document.getElementById('cancel-btn').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
                
                // Form submission
                document.getElementById('add-item-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    
                    fetch('/api/menu-items', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal and refresh menu items
                            document.body.removeChild(modal);
                            fetchMenuItems();
                        } else {
                            alert('Error adding item: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error adding item. Please try again.');
                    });
                });
            });
            
            // Edit menu item function
            function editMenuItem(item) {
                // Create edit modal similar to add modal but pre-filled with item data
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.left = '0';
                modal.style.top = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
                modal.style.display = 'flex';
                modal.style.justifyContent = 'center';
                modal.style.alignItems = 'center';
                modal.style.zIndex = '1000';
                
                const modalContent = document.createElement('div');
                modalContent.style.backgroundColor = 'white';
                modalContent.style.padding = '20px';
                modalContent.style.borderRadius = '10px';
                modalContent.style.maxWidth = '500px';
                modalContent.style.width = '90%';
                
                modalContent.innerHTML = `
                    <h2 style="margin-top: 0;">Edit Menu Item</h2>
                    <form id="edit-item-form">
                        <div style="margin-bottom: 15px;">
                            <label for="edit_item_name" style="display: block; margin-bottom: 5px;">Item Name *</label>
                            <input type="text" id="edit_item_name" name="item_name" value="${item.item_name}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="edit_description" style="display: block; margin-bottom: 5px;">Description</label>
                            <textarea id="edit_description" name="description" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 80px;">${item.description || ''}</textarea>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="edit_price" style="display: block; margin-bottom: 5px;">Price (â‚¹) *</label>
                            <input type="number" id="edit_price" name="price" value="${item.price}" step="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="edit_category" style="display: block; margin-bottom: 5px;">Category</label>
                            <input type="text" id="edit_category" name="category" value="${item.category || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label for="edit_image_url" style="display: block; margin-bottom: 5px;">Image URL</label>
                            <input type="text" id="edit_image_url" name="image_url" value="${item.image_url || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px;">Availability</label>
                            <label style="margin-right: 20px;">
                                <input type="radio" name="is_available" value="1" ${item.is_available !== 0 ? 'checked' : ''}>
                                Available
                            </label>
                            <label>
                                <input type="radio" name="is_available" value="0" ${item.is_available === 0 ? 'checked' : ''}>
                                Not Available
                            </label>
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                            <button type="button" id="edit-cancel-btn" style="padding: 10px 15px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 10px 15px; background: var(--orange); color: white; border: none; border-radius: 4px; cursor: pointer;">Update Item</button>
                        </div>
                    </form>
                `;
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Cancel button closes the modal
                document.getElementById('edit-cancel-btn').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
                
                // Form submission
                document.getElementById('edit-item-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const data = {};
                    formData.forEach((value, key) => {
                        data[key] = value;
                    });
                    
                    // Convert price to number
                    if (data.price) {
                        data.price = parseFloat(data.price);
                    }
                    
                    // Convert is_available to boolean
                    if (data.is_available) {
                        data.is_available = data.is_available === "1";
                    }
                    
                    fetch(`/api/menu-items/${item.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Close modal and refresh menu items
                            document.body.removeChild(modal);
                            fetchMenuItems();
                        } else {
                            alert('Error updating item: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error updating item. Please try again.');
                    });
                });
            }
            
            // Delete menu item function
            function deleteMenuItem(itemId) {
                if (confirm('Are you sure you want to delete this menu item?')) {
                    fetch(`/api/menu-items/${itemId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            fetchMenuItems();
                        } else {
                            alert('Error deleting item: ' + (data.error || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error deleting item. Please try again.');
                    });
                }
            }
            
            // Order handling event listeners
            document.querySelectorAll('.accept-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const order = this.closest('.order');
                    const statusSpan = order.querySelector('.order-status');
                    statusSpan.textContent = 'Accepted';
                    statusSpan.classList.remove('status-pending');
                    statusSpan.classList.add('status-completed');
                    this.parentElement.remove(); // Remove the action buttons
                });
            });
            
            document.querySelectorAll('.reject-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const order = this.closest('.order');
                    order.remove(); // Simply remove the order from the list
                });
            });

            // Check if current business is admin (ID 1) and show admin section
            function checkAdminStatus() {
                if (window.businessData && window.businessData.id === 1) {
                    // Show the admin section
                    document.getElementById('admin-section').style.display = 'block';
                    
                    // Show the student verification button
                    document.getElementById('student-verify-btn').style.display = 'flex';
                }
            }
        });
    </script>
</body>
</html> 